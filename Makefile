.PHONY: default full help clean check build

BUILD_DIR	:= ./build
CC			:= armv7a-linux-androideabi28-clang
CFLAGS		:= -DSHELL -Wall -Wextra -Werror
INCLUDE		:= -Isrc/include


default:
	@## An alias of "check" and "build".
	make check build


full:
	@## An alias of "clean", "check", and "build".
	make clean check build


help:
	@## Print this message and exit.
	@echo "Usage: make [options] [target] ...\nTargets:"
	@awk 'BEGIN{FS=":"} /^([a-z]|-)+:/{target=$$1; getline; printf "  %-20s%s\n", target, substr($$0, 6)}' $(MAKEFILE_LIST)


clean:
	@## Remove build caches.
	@echo Cleaning...
	rm -rf ${BUILD_DIR}
	rm src/*.o
	@echo Done.


check:
	@## Check the build environment.
	@if ! command -v ${CC} > /dev/null; then \
		echo "error: Command '${CC}' not found."; \
		exit 127; \
	fi


build:
	@## Build shrinker.
	@echo Building...
	mkdir -p ${BUILD_DIR}
	${CC} ${CFLAGS} ${INCLUDE} -o ${BUILD_DIR}/shrinker src/*.c
	@echo Build successful.
